<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Introduction to TDD :: ijrussell</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="In this post, we are going to start to use TDD. You will discover why I find the technique useful and discover how to write tests that allow you to change the implentation of your code in a safe way that doesn&#39;t introduce bugs or break the tests." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://ijrussell.github.io/posts/introduction-to-tdd/" />




<link rel="stylesheet" href="https://ijrussell.github.io/assets/style.css">

  <link rel="stylesheet" href="https://ijrussell.github.io/assets/green.css">






<link rel="apple-touch-icon" href="https://ijrussell.github.io/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://ijrussell.github.io/img/favicon/green.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="ijrussell" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Introduction to TDD">
<meta property="og:description" content="In this post, we are going to start to use TDD. You will discover why I find the technique useful and discover how to write tests that allow you to change the implentation of your code in a safe way that doesn&#39;t introduce bugs or break the tests." />
<meta property="og:url" content="https://ijrussell.github.io/posts/introduction-to-tdd/" />
<meta property="og:site_name" content="ijrussell" />

  
    <meta property="og:image" content="https://ijrussell.github.io/img/favicon/green.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2023-08-30 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    ijrussell
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/posts">Blog</a></li>
        
      
        
          <li><a href="/book">Book</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/posts">Blog</a></li>
      
    
      
        <li><a href="/book">Book</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://ijrussell.github.io/posts/introduction-to-tdd/">Introduction to TDD</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2023-08-30
        
      </span>
    
    
      <span class="post-author">:: ijrussell</span>
    
    
  </div>

  
  


  

  <div class="post-content"><div>
        <p>In this post, we are going to do some Test-Driven Development (TDD). I find TDD very useful because the tests are the first user of my code, which means that if the tests are hard to write, then the code will be difficult to use. Many folks struggle with TDD, and unit testing in general, because they test the wrong things. Your tests should only validate behaviour, not the implementation. This allows you to change the implementation of your code in a safe way. Not doing this makes your tests brittle and simple code changes often means broken and failing tests.</p>
<p>TDD is not a silver bullet but when you&rsquo;ve finished, the tests will leave you with a codebase and test suite that gives you confidence that the code will work as intended in production and help you to support changes to the implementation of the system in a safe and bug-free way.</p>
<h3 id="creating-a-recently-used-list">Creating a Recently Used List<a href="#creating-a-recently-used-list" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>We are going to create a simple recently used list of strings. The first stage of TDD is to think about the problem. What behaviour should our list offer - In other words, how are we going to use it? The basic behaviour we require is:</p>
<ul>
<li>Create a list with a maximum capacity</li>
<li>Add an item to the list</li>
<li>Retrieve the current list of items</li>
</ul>
<p>I don&rsquo;t think that anyone will ever want to know the capacity of a list but we could easily add it later if needed but it&rsquo;s not important to the core functionality of the list.</p>
<p>Retrieving the current list seems fairly simple, although looks can often be deceptive.</p>
<p>The complexity lies in adding an item to the list as it has a capacity. What happens when we reach capacity? The behaviour that we need to test is:</p>
<ul>
<li>A new list is empty</li>
<li>Add an item not in the list to:
<ul>
<li>an empty list</li>
<li>a non-empty list, not at capacity</li>
<li>a list at capacity</li>
</ul>
</li>
<li>Add an item already in the list to:
<ul>
<li>a non-empty list, not at capacity</li>
<li>a list at capacity</li>
</ul>
</li>
</ul>
<p>I&rsquo;m going to rearrange the items into a different order, so that the tests are grouped by their initial state as this makes a more logical grouping for our tests:</p>
<ul>
<li>A new list is empty</li>
<li>Given an empty list
<ul>
<li>Add an item</li>
</ul>
</li>
<li>Given a non-empty list, not at capacity
<ul>
<li>Add an item not in the list</li>
<li>Add an item already in the list</li>
</ul>
</li>
<li>Given a list at capacity
<ul>
<li>Add an item not in the list</li>
<li>Add an item already in the list</li>
</ul>
</li>
</ul>
<p>We are now ready to tackle the problem with TDD.</p>
<h3 id="getting-started">Getting Started<a href="#getting-started" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>We are going to write our code and tests in F#, using XUnit for the tests and FsUnit for the test assertions. Don&rsquo;t worry if you&rsquo;ve never written any F# before, the code isn&rsquo;t too hard to follow.</p>
<ol>
<li>
<p>Create an Xunit test project in your IDE/code editor of choice. Make sure to set the language as F#.</p>
</li>
<li>
<p>Add the FsUnit.Xunit Nuget package to the project.</p>
</li>
</ol>
<p>We are going to write the code and the tests in the same file.</p>
<p>Replace the code in the existing Tests.fs file with the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> RecentlyUsedListTests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Xunit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// - A new list is empty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given an empty list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given a non-empty list, not at capacity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item not in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item already in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given a list at capacity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item not in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item already in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> ``My test`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    Assert.True<span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Now run your tests. They should pass and everything should be green.</p>
<h3 id="test-1---a-new-list-is-empty">Test 1 - A new list is empty<a href="#test-1---a-new-list-is-empty" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Replace <code>My test</code> with the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a newly created recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``then it should contain no items`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3uy<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Assert.Equal<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;&gt;(</span>[]<span style="color:#f92672">,</span> sut<span style="color:#f92672">.</span>Items<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>If you&rsquo;re used to writing tests in C#, you may be surprised at the ability to group tests, using module, and at the use of real language rather than having to use special casing or seperators. Since C# and F# projects can co-exist in the same solution, C# code can be tested in F# test projects, so you don&rsquo;t have to miss out. Of course, it means that you have to learn some basic F#. But that&rsquo;s a good thing, isn&rsquo;t it?</p>
<p>At the moment, the code won&rsquo;t compile, so we need to implement our Recently Used List.</p>
<p>Since I want to encapsulate a mutable list, I&rsquo;m going to use an F# class type. Yes, F# has a very strong object programming story!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#75715e">//   - a list at capacity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">string</span> capacity<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a newly created recently used list`` <span style="color:#f92672">=</span>
</span></span></code></pre></div><p>Items is a readonly property that returns a list containing the capacity as a string.</p>
<p>Run your tests. This test should fail because the test expects an empty list and we haven&rsquo;t provided that.</p>
<blockquote>
<p>You should always write a test that fails for an expected reason and then fix it.</p>
</blockquote>
<p>Let&rsquo;s fix the test by doing the simplest thing to the <code>RecentlyUsedList</code> that we can which is to return an empty list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> []
</span></span></code></pre></div><p>Sadly, this doesn&rsquo;t compile because we are returning an untyped (object) list rather than a list of strings. As we will see, this is only a problem for the Xunit assert and not for FsUnit. Let fix this by changing the empty list to a typed one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> List.empty<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>Run the tests and they should now all pass.</p>
<h3 id="using-fsunit-for-assertions">Using FsUnit for Assertions<a href="#using-fsunit-for-assertions" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Add a reference to the FsUnit.Xunit library:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> RecentlyUsedListTests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Xunit
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> FsUnit.Xunit
</span></span></code></pre></div><p>Comment out the existing assert and add use FsUnit instead:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a newly created recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``then it should contain no items`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3uy<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assert.Equal&lt;List&lt;string&gt;&gt;([], sut.Items)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal List.empty<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>On the whole, F# does not support implicit conversions, so we must specify the type of the data, in this case the byte with <code>uy</code>.</p>
<p>FsUnit is similar to libraries like FluentAssertions and, to my eyes, is a lot more readable than the original Xunit assertion.</p>
<p>Run the tests and they should all pass.</p>
<p>We can make it even simpler:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a newly created recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``then it should contain no items`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3uy<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Assert.Equal&lt;List&lt;string&gt;&gt;([], sut.Items)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal List.empty<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should be Empty
</span></span></code></pre></div><p>Delete the top two assertions and run the tests again. they should all pass.</p>
<p>We can change the <code>RecentlyUsedList</code> code back to an empty list if we want but we are going to implement it properly soon. If you do this, remember to run your tests and make sure that they still pass.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> []
</span></span></code></pre></div><h3 id="test-2---add-an-item-to-an-empty-list">Test 2 - Add an item to an empty list<a href="#test-2---add-an-item-to-an-empty-list" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Write the new test in a new module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given an empty recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item then the list contains only that item`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3uy<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run your tests and this test should fail because we are returning an empty list.</p>
<p>Let&rsquo;s start implementing the feature. The first stage is to add a mutable list. In this case, I&rsquo;m going to add the C# List, which is called ResizeArray in F# because F# has it&rsquo;s own list type already.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> []
</span></span></code></pre></div><p>At this point, we get a compiler error as the ResizeArray doesn&rsquo;t take a byte for capacity. Change the capacity type to int:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> []
</span></span></code></pre></div><p>Now our tests won&rsquo;t compile. This is a bad thing. Roll back to the last time that the tests passed. Change the signature of the <code>RecentlyUsedList</code> capacity input parameter to be an integer (int). Run the tests and they should pass.</p>
<p>Now we can add our second test again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given an empty recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item then the list contains only that item`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run the tests and the latest only should fail because we are returning an empty list from the <code>RecentlyUsedList</code>. Even to do the simplest thing will involve a few lines of code.</p>
<p>Firstly, we add a new member function for adding an item to the list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> []
</span></span></code></pre></div><p>Then we return the items from the internal list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList
</span></span></code></pre></div><p>Run the tests and they should all pass. Success!</p>
<h3 id="test-3---add-a-new-item-to-a-non-empty-list-not-at-capacity">Test 3 - Add a new item to a non-empty list, not at capacity<a href="#test-3---add-a-new-item-to-a-non-empty-list-not-at-capacity" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Let&rsquo;s add a new module and test under the existing ones:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a non-empty recently used list that is not at capacity`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item not already in list then the item is added to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run the tests and this one should fail because the items are in the wrong order. Let&rsquo;s fix that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList <span style="color:#f92672">|&gt;</span> List.rev
</span></span></code></pre></div><p>Run your tests and they should all pass.</p>
<p>Now that the tests pass, let&rsquo;s do some refactoring to make the next features easier to implement. Move the Add functionality to a new internal function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> add item <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList <span style="color:#f92672">|&gt;</span> List.rev
</span></span></code></pre></div><p>Run the tests and they should all pass.</p>
<h3 id="test-4---add-an-item-already-in-the-list">Test 4 - Add an item already in the list<a href="#test-4---add-an-item-already-in-the-list" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Add the following test under the existing ones in the same module as Test 3:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item already in list then the item is moved to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run the tests and this one will fail with too many items in the list. We can fix that by removing the item and then adding it again.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> add item <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        item <span style="color:#f92672">|&gt;</span> items<span style="color:#f92672">.</span>Remove <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>        items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList <span style="color:#f92672">|&gt;</span> List.rev
</span></span></code></pre></div><p>The ignore is there to remove a compiler warning as items.Remove returns a boolean which we are not interested in.</p>
<p>Run the tests and they should all pass.</p>
<h3 id="test-5---given-a-list-at-capacity-add-an-item-not-in-the-list">Test 5 - Given a list at capacity, add an item not in the list<a href="#test-5---given-a-list-at-capacity-add-an-item-not-in-the-list" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>As our tests pass, we can add another test. We have now reached the tests when the list is at capacity. Add the new module and test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a recently used list that is at capacity`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item not in the list then the new item is added and the oldest item is dropped from the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run the tests and this one will fail as it will contain too may items since capacity is only a starting point for the ResizeArray.</p>
<p>Let&rsquo;s fix that by removing the first item from the list if the list is at capacity:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> add item <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        items<span style="color:#f92672">.</span>Remove item <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> items<span style="color:#f92672">.</span>Count <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>Capacity <span style="color:#66d9ef">then</span> items<span style="color:#f92672">.</span>RemoveAt 0
</span></span><span style="display:flex;"><span>        items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">:</span><span style="color:#66d9ef">string</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span> add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList <span style="color:#f92672">|&gt;</span> List.rev
</span></span></code></pre></div><p>Run the tests and they should all pass.</p>
<h3 id="test-6---given-a-list-at-capacity-add-an-item-already-in-the-list">Test 6 - Given a list at capacity, add an item already in the list<a href="#test-6---given-a-list-at-capacity-add-an-item-already-in-the-list" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Let&rsquo;s write our test:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item already in the list then the item is moved to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run the tests and they all pass. If you think about it, we are duplicating Test 4 as we are moving an existing item to the top of the list. Normally, we would delete this test but I&rsquo;m going to keep it in for completeness.</p>
<p>As our tests pass, we can do a little refactoring to the last two tests to handle setting up the at capacity list.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a recently used list that is at capacity`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> createAtCapacityList() <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item not in the list then the new item is added and the oldest item is dropped from the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> createAtCapacityList()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item already in the list then the item is moved to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> createAtCapacityList()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Run our tests and they should all pass.</p>
<p>We have completed our task and this is what we have finally ended up with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> RecentlyUsedListTests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> Xunit
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">open</span> FsUnit.Xunit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// - A new list is empty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given an empty list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given a non-empty list, not at capacity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item not in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item already in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Given a list at capacity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item not in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//   - Add an item already in the list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RecentlyUsedList</span><span style="color:#f92672">(</span>capacity<span style="color:#f92672">:</span>int<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> items <span style="color:#f92672">=</span> ResizeArray<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span><span style="color:#f92672">&gt;(</span>capacity<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> add item <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        item <span style="color:#f92672">|&gt;</span> items<span style="color:#f92672">.</span>Remove <span style="color:#f92672">|&gt;</span> ignore
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> items<span style="color:#f92672">.</span>Count <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span>Capacity <span style="color:#66d9ef">then</span> items<span style="color:#f92672">.</span>RemoveAt 0
</span></span><span style="display:flex;"><span>        items<span style="color:#f92672">.</span>Add item
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Add</span><span style="color:#f92672">(</span>item<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> add item
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">member</span> _.<span style="color:#a6e22e">Items</span> <span style="color:#f92672">=</span> items <span style="color:#f92672">|&gt;</span> Seq.toList <span style="color:#f92672">|&gt;</span> List.rev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a newly created recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``then it should contain no items`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should be Empty
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given an empty recently used list`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add one item then the list contains only that item`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a non-empty recently used list that is not at capacity`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item not already in list then the item is added to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item already in list then the item is moved to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">module</span> ``Given a recently used list that is at capacity`` <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> createAtCapacityList() <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> RecentlyUsedList<span style="color:#f92672">(</span>capacity <span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        sut
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item not in the list then the new item is added and the oldest item is dropped from the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> createAtCapacityList()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item4&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[&lt;</span>Fact<span style="color:#f92672">&gt;]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ``when you add an item already in the list then the item is moved to the start of the list`` () <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> sut <span style="color:#f92672">=</span> createAtCapacityList()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Add<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        sut<span style="color:#f92672">.</span>Items <span style="color:#f92672">|&gt;</span> should equal <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;Item2&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item3&#34;</span><span style="color:#f92672">;</span><span style="color:#e6db74">&#34;Item1&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>It might seem like a lot of work but we have some code that we know is easy to use and that has behaviour that is thoroughly tested.</p>
<h3 id="red-green-refactor">Red Green Refactor<a href="#red-green-refactor" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>If your tests are passing, you can write a new failing test (Red). You write enough code to get the tests to pass (Green). You can then improve your code in small steps (Refactor). Your tests should still pass. If your tests do not pass, undo your changes back to the last time that they passed and try again.</p>
<blockquote>
<p>Never refactor when the tests are failing. Undo your changes and try again.</p>
</blockquote>
<h3 id="summary">Summary<a href="#summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>I hope that you found this post both useful and informative. TDD is not too difficult if you think about the behaviour you want to test beforehand and follow a few simple rules. The benefits that it provides far outway any potential initial time costs.</p>
<p>Getting good at TDD is a result of experience and practice. Your code can only improve by using more of it.</p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://ijrussell.github.io/posts/my-last-project/">
                <span class="button__icon">←</span>
                <span class="button__text">Integrating With Over 300 GPS Providers</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://ijrussell.github.io/posts/top-10-books-2023/">
                <span class="button__text">My Favourite Development Books 2023</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
  

  
</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2023 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://ijrussell.github.io/assets/main.js"></script>
<script src="https://ijrussell.github.io/assets/prism.js"></script>







  
</div>

</body>
</html>
